# Terrafarm Mobile App
This mobile application - created using `Flutter` - aims to provide farmers with localized insights about their fields, by using drone technology to capture multi-spectral images of their crops. Both Android and iOS are supported.
Insights are generated by our image processing pipeline (under `src/pipeline`), as well as our high-fidelity agricultural data source.   
Through an intuitive dashboard, farmers are able to automatically track historical field status. Specifically, users can pick insight maps (e.g. NDVI or soil moisture) and localized insights (e.g. nutrient deficiencies or pests). Moreover, new fields can be added to the system.

<p align="center">
    <p align="center">
        <img src="https://user-images.githubusercontent.com/74115586/219355950-a4476798-28a1-4ca1-aa8b-85b7556fc3fe.png" width="450" />
        &nbsp &nbsp
        <img src="https://user-images.githubusercontent.com/74115586/219356529-b53a18b4-6995-4cd0-9b3e-4c054c97cd46.png" width="300" />
         &nbsp &nbsp
        <img src="https://user-images.githubusercontent.com/74115586/219357528-0ea762fe-0228-4e00-8d6e-9baad15b8fbc.png" width="470" />
         &nbsp &nbsp
        <img src="https://user-images.githubusercontent.com/74115586/219357760-b6b828e5-6330-4898-82cd-9eb31c03e607.png" width="300" />
        <!-- &nbsp &nbsp
        <img src="https://user-images.githubusercontent.com/74115586/219358000-6267bbd4-87cf-40ec-8459-26cc5ff6af04.png" width="400" /> -->
    </p>
</p>

<p align="center">Example screenshots</p>


## Getting started

### Step 1

Download or clone this repository by using the following link: 
`https://github.com/GDSC-Delft-Dev/apa.git`

### Step 2

Navigate to the Flutter project root `.../apa/src/frontend` and download dependencies for the Flutter project from Pub (package manager for Dart) by entering the following in your Flutter console:
````
flutter pub get
````
Optionally: upgrade the dependencies for the Flutter project to the latest available versions
````
flutter pub upgrade
````

### Step 3

Run the Flutter project on an attached device or emulator:
````
flutter run
````

### Useful Flutter commands

Clean the build files generated by Flutter, which can help to resolve issues with the build process
````
flutter clean
````
Build a release version of the app for deployment:
````
flutter build
````
Run unit and widget tests for the Flutter project:
````
flutter test
````
Get information about installed tooling required for Flutter development
````
flutter doctor
````


## How to use

### Logging into the app
You can use the following dummy credentials for logging into the application:
````
e-mail: andyzaidman42@tudelft.net
password: andy12345
````
For all invalid authentication attempts, an error message will be displayed.

### Firebase

Follow [these instructions](https://firebase.google.com/docs/flutter/setup?platform=ios) in order to configure Firebase into your local project.
Note that `flutterfire configure` will auto-create files containing private project details:
- `...apa/src/frontend/android/app/google-services.json`
- `...apa/src/frontend/lib/firebase_options.dart`
- `...apa/src/frontend/ios/firebase_app_id_file.json`
- `...apa/src/frontend/ios/Runner/GoogleService-Info.plist`

All of these are gitignored, but make sure these are added to your local project.

### Google Maps API
In order to be able to use Google Maps API, several steps need to be taken with regards to private key configuration.

- Navigate to this Terrafarm project under the Google Cloud console to access the private API key for Google Maps (restricted access however).
- To run on Android - add the following to the `src/apa_app/android/local.properties` file:
````
GMapsAPIKey={YOUR_PRIVATE_GOOGLE_MAPS_API_KEY}
````` 
- To run on iOS - add the following to the `src/frontend/ios/Flutter/Debug.xcconfig` file:
```` 
#include "Generated.xcconfig"
GOOGLE_MAPS_API_KEY={YOUR_PRIVATE_GOOGLE_MAPS_API_KEY}
````
Note that `local.properties` and `Debug.xcconfig` are both under `.gitignore`.
- To access env vars from source code - create a `.env` file under the `lib` directory with the following contents:
````
GOOGLE_MAPS_API_KEY={YOUR_PRIVATE_GOOGLE_MAPS_API_KEY}
````

## Tools and Libraries Used
- [Google Maps Platform](https://mapsplatform.google.com/)
- [Firebase](https://firebase.google.com/) - Authentication, Cloud Firestore, hosting
- [Google Cloud Storage](https://cloud.google.com/storage)
- [Cloud Functions](https://cloud.google.com/functions)

## Folder Structure

Below is visualized the default folder structure provided by Flutter:
````
flutter-app/
|- android
|- build
|- ios
|- lib
|- test
````

`lib` folder structure we use is as follows:
````
lib/
|- models/ - Data models that correspond to our Firebase documents (e.g. fields, crops)
|- providers/ - Containers that hold application state and notify listeners
|- services/ - Business logic that queries external API endpoints
|- views/ - Main UI widgets of the application
|- widgets/ - Common widgets used in the application
| - stores/ - Services that handle database querying
|- utils/ - Common utility functions of the application
|- main.dart - Starting point of the application - all the application level configurations are defined in this file i.e, theme, routes, title etc.
````

## Routes
The following routes are defined in `main.dart`
````
      routes: {
        '/': (context) => const Wrapper(),
        '/load': (context) => Loading(),
        '/home': (context) => const Home(title: 'Terrafarm'),
        '/add': (context) => const AddField(),
        '/fields': (context) => const MyFields(),
        '/settings': (context) => const Settings(),
        '/login': (context) => Authenticate(),
        '/crop_growth': (context) => const CropGrowth(),
        '/field_details': (context) => const FieldDetails(),
      }
````
The initial route that is entered is the `Wrapper()`, which listens for authentication status changes - will return `MainPage()` if logged in or `Authenticate()` if not logged in (both under `views/`).
`MainPage()` renders screen that the user sees currently - which screen is displayed depends on which icon is toggled in the bottom navigation bar.

## Data Models
````
lib/models/
|- user_model.dart - represent users of the application
|- field_model.dart - represent fields owned by users
|- insight_model.dart - represent insights detected by the image processing pipeline, specific to soem geolocation within given field
|- crop_model.dart - represent crops that are grown in fields (e.g. lettuce, aloe vera)
````


## Providers
````
lib/providers/
|- insight_choices_provider.dart - handles user preferences regarding visualization of field insights
|- map_settings_provider.dart - handles user preferences regarding maps displayed (e.g. map type, zoom level)
|- new_field_provider.dart - handles the process of adding new fields to the system
````


## Services
````
lib/services/
|- auth_service.dart - communicates with Firebase Authentication API to handle user management
|- location_service.dart - communinates with Google Maps API to handle searching for locations on the map
````



## Stores
````
lib/stores/
|- user_store.dart - handles CRUD operations regarding the user model
|- fields_store.dart - handles CRUD operations regarding the field model
|- insights_store.dart - handles CRUD operations regarding the insights model
|- crop_store.dart - handles CRUD operations regarding the crop model
````


<!-- ## Cloud Functions -->


